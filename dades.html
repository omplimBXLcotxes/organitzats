<html ng-app="MyApp">

<head>
    <title>Cotxes BrusselÂ·les</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    <meta http-equiv="Cache-Control" content="no-cache, mustrevalidate">
    <meta http-equiv="Pragma" content="no-cache">

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
    <!-- Angular -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-moment/0.9.0/angular-moment.min.js"></script>
    <script src="https://unpkg.com/@uirouter/angularjs@1.0.7/release/angular-ui-router.min.js"></script>
    <!-- unminified for development -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-google-chart/1.0.0-beta.1/ng-google-chart.js" type="text/javascript"></script>

    <!-- minified for production -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-google-chart/1.0.0-beta.1/ng-google-chart.min.js" type="text/javascript"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/2.0.1/angularfire.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyBDtg6KdSR_M7zoIf_vBovQHBWrNu3PQkE",
            authDomain: "cotxesbrusselles.firebaseapp.com",
            databaseURL: "https://cotxesbrusselles.firebaseio.com",
            projectId: "cotxesbrusselles",
            storageBucket: "cotxesbrusselles.appspot.com",
            messagingSenderId: "71052176283"
        };
        firebase.initializeApp(config);

    </script>
    <script src="js/main-angular.js"></script>
    <script type="text/javascript">
        // Load the Visualization API and the corechart package.
        google.charts.load('current', {
            'packages': ['corechart']
        });

        // Set a callback to run when the Google Visualization API is loaded.
        //google.charts.setOnLoadCallback(drawChart);

    </script>
</head>

<body ng-controller="DadesCtrl">
    <style>
        .chart {
            box-sizing: border-box;
            display: inline-block;
            width: 50%;
            height: 2200;
        }

    </style>
    <div id="chart_div" class="chart"></div>
    <script>
        app.controller("DadesCtrl", function($scope, $state, $stateParams, $firebaseArray, $firebaseObject) {
            var ref = firebase.database().ref();
            $scope.cotxes = $firebaseArray(ref.child("cotxes"));

            function compressArray(original) {

                var compressed = [];
                // make a copy of the input array
                var copy = original.slice(0);

                // first loop goes over every element
                for (var i = 0; i < original.length; i++) {

                    var myCount = 0;
                    // loop over every element in the copy and see if it's the same
                    for (var w = 0; w < copy.length; w++) {
                        if (original[i] == copy[w]) {
                            // increase amount of times duplicate is found
                            myCount++;
                            // sets item to undefined
                            delete copy[w];
                        }
                    }

                    if (myCount > 0) {
                        if (original[i]) {
                            var a = [original[i], myCount];
                            compressed.push(a);
                        }
                    }
                }

                return compressed;
            };

            $scope.cotxes.$loaded().then(function() {
                $scope.comarques = [];
                $scope.provincies = [];
                $scope.cotxes.forEach(function(cotxe) {
                    $scope.comarques.push(cotxe.comarca);
                });
                setTimeout(function() {}, 1000)
                drawChart(compressArray($scope.comarques));
            });

            function drawChart(dades) {
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Comarca');
                data.addColumn('number', 'Vehicles registrats');
                data.addRows(dades);

                // Set chart options
                var options = {
                    'title': 'Comarques'
                };

                // Instantiate and draw our chart, passing in some options.
                var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
                chart.draw(data, options);
            }
        });

    </script>
</body>

</html>
